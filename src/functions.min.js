import axiosA from"axios";import{ref,watch}from"vue";import DateFunc from"./DateTime";function validateForm(obj,rules){let validated={allValid:!0};for(let r in rules)if(("required"==rules[r]||rules[r].isRequired)&&null==obj[r]||""==obj[r])validated[r]="empty";else if(("required"!=rules[r]||rules[r].isRequired)&&null==obj[r]||""==obj[r])validated[r]=!0;else if("callback"!=r){let emailregex=/[a-z0-9._]+@[a-z]+\.[a-z]{2,}/i,intregex=/[0-9]+/,floatregex=/[0-9]+.[0-9]+/;if(validated[r]=!0,rules[r].isEmail&&obj[r].toLowerCase().match(emailregex))validated[r]=!0;else if(rules[r].isEmail){validated[r]="invalid_email";continue}if(rules[r].isInteger&&obj[r].match(intregex))validated[r]=!0;else if(rules[r].isInteger){validated[r]="invalid_number";continue}if(rules[r].isFloat&&(obj[r].match(floatregex)||obj[r].match(intregex)))validated[r]=!0;else if(rules[r].isFloat){validated[r]="invalid_number";continue}if(null!=rules[r].regexMatch&&obj[r].match(rules[r].regexMatch))validated[r]=!0;else if(null!=rules[r].regexMatch){validated[r]="value_and_regex_not_match";continue}if(null!=rules[r].equalTo&&obj[r]==rules[r].equalTo)validated[r]=!0;else if(null!=rules[r].equalTo){validated[r]="values_not_match";continue}if("number"==typeof rules[r].maxChars&&rules[r].maxChars>=obj[r].length)validated[r]=!0;else if("number"==typeof rules[r].maxChars){validated[r]="invalid_length_max";continue}if("number"==typeof rules[r].minChars&&rules[r].minChars<=obj[r].length)validated[r]=!0;else if("number"==typeof rules[r].minChars){validated[r]="invalid_length_min";continue}}let someEmpty=!1;if(null!=rules.callback)for(let v in validated)"empty"!==validated[v]||(validated.allValid=!1,rules.callback(v),someEmpty=!0);if(!someEmpty)for(let v in validated)1==validated[v]||(validated.allValid=!1,null==rules[v].callback)||rules[v].callback(validated[v]);return validated}function formatDateString(dateString){let digits=dateString.matchAll(/[0-9]+/g),digitsArr=[];for(const d of digits)1==new String(d).length?digitsArr.push("0"+d):digitsArr.push(d);let newString="";for(let i=0;i<digitsArr.length;i++)i<2?newString=newString+digitsArr[i]+"-":2==i?newString=newString+digitsArr[i]+" ":i>2&&i!=digitsArr.length-1?newString=newString+digitsArr[i]+":":i==digitsArr.length-1&&(newString+=digitsArr[i]);return newString}const timezoneOffset=-300;function dateFormat(format="",dateString=""){return new DateFunc(dateString).format(format)}function dateFormatTimezone(format="",dateString=""){return new DateFunc(dateString).offset().format(format)}function dateAdjusted(yearOrDateString=null,month=null,day=null){return new DateFunc(yearOrDateString,month,day).dateObj}function dateOffseted(yearOrDateString=null,month=null,day=null){return new DateFunc(yearOrDateString,month,day).offset().dateObj}class Axios{constructor(baseUrl,defHeaders){this.baseUrl=baseUrl,this.defHeaders=defHeaders}get(endpoint){return axiosA({method:"get",url:endpoint})}toFormData(obj){var fd=new FormData;for(var i in obj)fd.append(i,obj[i]);return fd}async post(endpoint,headers=null,body=null,opts={}){let params={method:"post",url:this.baseUrl+endpoint};return"default"==headers?params.headers=this.defHeaders:null!=headers&&(params.headers=headers),null!=body&&(params.data=this.toFormData(body)),params={...params,...opts},axiosA(params)}}const apiURLs={localhost:window.location.protocol+"//localhost/pw-bookingapp/api/",network:window.location.protocol+"//ns.proweaver.host/pw-bookingapp/api/",launched:window.location.protocol+"//"+window.location.hostname+"/pw-bookingapp/api/",capoe:"https://www.capoecounselingllc.com/pw-bookingapp/api/"},axios=new Axios(apiURLs.capoe,{pwauth:"TWxBUUJPbUdPM1g5NDJxUm5Ncnp6UnlrZ2xRSlJyeXcvQ0RGNDVVYTRKMUprK0tPZjFrV3IrdHZrbkYvci9saGtQRGF5NnZmWEZveVl3TjNSYjVEUmc9PTo6OPee3c+XRvB5vpYEn0QVbg"});function elementLoad(selector){return new Promise(resolve=>{var check=setInterval((function(){null!=document.querySelector(selector)&&(clearInterval(check),resolve(document.querySelector(selector)))}),100)})}const lStoreVals=ref({});null!=localStorage.getItem("async_locals")&&(lStoreVals.value=JSON.parse(localStorage.getItem("async_locals"))),window.onbeforeunload=()=>localStorage.setItem("async_locals",JSON.stringify(lStoreVals.value));export function watchLStore(key,func){watch(lStoreVals.value[key],func)}export const lStore=lStoreVals.value;function removeFix(object,fix){let newObj={};for(let k in object){let key;newObj[k.toLowerCase().replaceAll(fix,"")]=object[k]}return newObj}class PaypalIntegration{init(apikey,currency,callback,merchantID=""){const script=document.createElement("script");null!=document.getElementById("paypalScript")&&document.getElementById("paypalScript").remove(),script.src=`https://www.paypal.com/sdk/js?components=buttons&currency=${currency}&client-id=${apikey}${""!=merchantID?"&merchant-id="+merchantID:""}`,script.id="paypalScript",document.body.appendChild(script),script.addEventListener("load",callback(this))}mountOn(selector,value,currency_code="USD",description=""){return new Promise(async(res,rej)=>{if(null==value)return void res();if(value=parseFloat(value),await elementLoad(selector),""!=document.querySelector(selector).innerHTML)return void res();const proceedTransaction=()=>{window.paypal.Buttons({createOrder:(data,actions)=>value>0?actions.order.create({purchase_units:[{description:description,amount:{currency_code:currency_code,value:value},payee:{email_address:"kbaring4school@google.com"}}]}):void alert("The value should be more than 0"),onApprove:async()=>{res(!0)},onError:err=>{rej(err)}}).render(selector)};let interval=setInterval(()=>{null!=window.paypal&&(document.querySelector(selector).children.length>0?clearInterval(interval):(proceedTransaction(),clearInterval(interval)))},100)})}}const Paypal=new PaypalIntegration;function delayExec(ms){return new Promise(resolve=>setTimeout(resolve,ms))}function hexToHsl(H){let r=0,g=0,b=0;4==H.length?(r="0x"+H[1]+H[1],g="0x"+H[2]+H[2],b="0x"+H[3]+H[3]):7==H.length&&(r="0x"+H[1]+H[2],g="0x"+H[3]+H[4],b="0x"+H[5]+H[6]),r/=255,g/=255,b/=255;let cmin=Math.min(r,g,b),cmax=Math.max(r,g,b),delta=cmax-cmin,h=0,s=0,l=0;return h=0==delta?0:cmax==r?(g-b)/delta%6:cmax==g?(b-r)/delta+2:(r-g)/delta+4,h=Math.round(60*h),h<0&&(h+=360),l=(cmax+cmin)/2,s=0==delta?0:delta/(1-Math.abs(2*l-1)),s=+(100*s).toFixed(1),l=+(100*l).toFixed(1),{h:h,s:s,l:l}}function waitForCondition(condition,interval=1e3){return new Promise((resolve,reject)=>{const checkCondition=()=>{condition()?resolve():setTimeout(checkCondition,interval)};checkCondition()})}export{validateForm,dateFormat,dateFormatTimezone,dateAdjusted,dateOffseted,formatDateString,axios,elementLoad,removeFix,Paypal,delayExec,hexToHsl,waitForCondition};